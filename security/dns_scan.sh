#!/bin/bash
#
# Check DNS recors for most common hostnames of given domain.
#
# Usage: dns_scan.sh example.org
#
# ------------------------------------------------------------------------------
# Author: Martin 'BruXy' Bruchanov, bruchy (a) gmail.com
# GitHub: https://github.com/BruXy/bash-utils/tree/master/security
# ------------------------------------------------------------------------------
#

DOMAIN=${1:?"Missing domain!"}

TEST=(ftp www host mail dummy)

# Top hostnames are taken from ISC surveys
# ========================================
#
# Source: https://downloads.isc.org/www/survey/reports/
#
## Mirror ISC surveys
#  ------------------
#
# wget -e robots=off -r -L --mirror --convert-links --adjust-extension
#    --page-requisites --no-parent \
#    --accept htm,html,first.txt https://downloads.isc.org/www/survey/reports/
#
## Process data: remove counts, sort and remove duplicities
#  --------------------------------------------------------
#
# find downloads.isc.org/ | grep -E 'first.txt|firstnames.html' |\
#    xargs grep -h -E '^[[:space:]]+[0-9]+' |\
#    sed -E -e 's/ [0-9]+ //g' -e 's/[[:space:]]+/ /g' |\
#    tr ' ' '\n' | sort -u

TOP_HOSTS=(
    a
    a0
    a1
    a2
    a3
    a4
    a5
    a6
    a7
    a8
    a9
    aa
    ab
    ac
    ad
    admin
    adsl
    ae
    af
    alpha
    ama-wldhcp
    apollo
    ariel
    athena
    atlas
    b
    b0
    b1
    b2
    b3
    b4
    b5
    b6
    b7
    b8
    b9
    ba
    backup
    bb
    bbs
    bc
    bcast
    bd
    be
    beta
    bf
    broadcaspc14
    broadcast
    broadcasthermes
    broadcastpc19
    c
    c0
    c1
    c3
    c4
    c5
    c6
    c7
    c8
    ca
    calvin
    cb
    cc
    cd
    ce
    cf
    cgi
    charon
    cisco
    cm
    cpe
    d
    d0
    d1
    d2
    d3
    d4
    d5
    d6
    d7
    d8
    d9
    da
    db
    dc
    dd
    de
    delta1
    demo
    demon-gw
    dev
    df
    dialup
    dns
    dns1
    dns2
    dsl
    dsl-78
    dsl78
    dsl85
    dsl88
    dsl95
    dummy
    e
    e0
    e1
    e3
    e4
    e5
    e6
    e7
    e8
    eagle
    earth
    eb
    ec
    ed
    ee
    ef
    email
    enterprise
    eth0
    exchange
    f
    f0
    f1
    f5
    f7
    f8
    f9
    falcon
    fb
    fc
    fd
    ff
    firewall
    fred
    free
    ftp
    fw
    gandalf
    gate
    gatekeeper
    gatekeepernewton
    gatekeepfalcon
    gateway
    gatewaypc13
    gauss
    gopher
    gw
    gw1
    h
    hermes
    hobbes
    home
    homer
    host
    host1
    host10
    host11
    host12
    host13
    host14
    host15
    host16
    host17
    host18
    host19
    host2
    host20
    host21
    host22
    host23
    host24
    host25
    host26
    host27
    host28
    host29
    host3
    host30
    host4
    host5
    host6
    host7
    host8
    host9
    hsi
    hub
    info
    intranet
    ip
    ip1
    ip10
    ip107
    ip109
    ip11
    ip117
    ip12
    ip13
    ip14
    ip2
    ip207
    ip208
    ip3
    ip4
    ip5
    ip6
    irc
    iris
    isp
    jupiter
    jupiterws2
    l0
    linux
    lo0
    loopback0
    lwdc
    lxxxix
    mac
    mac1
    mac2
    mail
    mail01
    mail1
    mail2
    mail3
    mail4
    mail5
    mailgate
    mailhost
    mailhostalpha
    mailhostgate
    mailhosthost3
    mailhostjupiter
    mailhostmac1
    mailhostwww1
    mailserver
    main
    mars
    master
    max
    meb
    mercury
    mercurypc31
    merlin
    mickey
    mout
    mta
    mx
    mx1
    mx2
    mx3
    mx4
    mx5
    mx6
    neptune
    net
    network
    news
    newton
    nmd
    nmd-fa2
    nomail
    ns
    ns1
    ns2
    ns3
    ns4
    nt
    o1
    office
    orion
    owa
    p204
    pc
    pc01
    pc1
    pc10
    pc11
    pc12
    pc13
    pc14
    pc15
    pc16
    pc17
    pc18
    pc19
    pc2
    pc20
    pc21
    pc22
    pc23
    pc24
    pc25
    pc26
    pc27
    pc28
    pc29
    pc3
    pc30
    pc32
    pc33
    pc34
    pc36
    pc37
    pc38
    pc39
    pc4
    pc40
    pc5
    pc6
    pc7
    pc8
    pc9
    phoenix
    pipex-gw
    pluto
    pop
    pop3
    portal
    ppp1
    ppp10
    ppp11
    ppp12
    ppp13
    ppp14
    ppp15
    ppp2
    ppp3
    ppp4
    ppp5
    ppp6
    ppp7
    ppp8
    proxy
    r
    relay
    remote
    resv
    router
    rtr1
    s0
    s1
    saturn
    sdtc
    se400
    secure
    server
    server1
    server2
    sirius
    smtp
    smtp1
    smtp2
    snoopy
    spock
    srv1
    static
    stats
    stnet
    sun
    support
    surfer
    sv
    sv1
    sv2
    sv3
    sv4
    sv5
    sv6
    sv7
    sv8
    szerver1
    szerver2
    szerver3
    szerver4
    szerver5
    t1
    t3
    telnet
    test
    thor
    tiger
    titan
    ts1
    uranus
    user
    v1
    v2
    venus
    voyager
    vpn
    vps
    vs1
    vs2
    vs3
    vs4
    vs5
    vs6
    vs7
    web
    web1
    web2
    webmail
    wk1
    wk10
    wk11
    wk12
    wk13
    wk14
    wk15
    wk16
    wk17
    wk18
    wk19
    wk2
    wk20
    wk21
    wk22
    wk23
    wk24
    wk25
    wk26
    wk27
    wk28
    wk29
    wk3
    wk30
    wk31
    wk32
    wk33
    wk34
    wk35
    wk36
    wk37
    wk38
    wk39
    wk4
    wk40
    wk41
    wk42
    wk43
    wk44
    wk45
    wk5
    wk6
    wk7
    wk8
    wk9
    ws
    ws1
    ws10
    ws11
    ws12
    ws13
    ws2
    ws3
    ws4
    ws5
    ws6
    www
    www1
    www2
    www3
    x137
    xcii
    zeus
)

function host2ip() {
    # Query DNS, remove dots from hostnames, join lines, trim white-spaces
    answer=$(dig +short $1 | sed 's/\.$//' | paste -s | tr -s ' ')
    if [[ -z "$answer" ]]
    then
        echo "N/A"
    else
        echo "$answer"
    fi
}

printf "Hostname -> A/CNAME record\n"

#for host in ${TEST[*]}
for host in ${TOP_HOSTS[*]}
do
    host=${host}.${DOMAIN}
    ip_addr=$(host2ip $host)
    printf "%s -> %s\n" $host "$ip_addr"
done | grep -v 'N/A'

